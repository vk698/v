<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyHub - Community</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Base Styles (reused from homepage) */
        :root {
            --primary: #4a6fa5;
            --primary-dark: #3a5a8c;
            --secondary: #ff6b6b;
            --secondary-dark: #e05555;
            --dark: #2c3e50;
            --dark-light: #3a516f;
            --light: #f0f4f8;
            --light-dark: #e0e8f0;
            --text: #333;
            --text-light: #666;
            --text-lighter: #999;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --white: #ffffff;
            --black: #000000;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            line-height: 1.6;
            color: var(--text);
            background-color: #f9f9f9;
            overflow-x: hidden;
        }
        
        /* 3D Scene Container */
        #threejs-community-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
            transition: opacity 0.5s;
        }
        
        #threejs-community-container.active {
            opacity: 0.3;
            z-index: 1;
        }
        
        /* 3D Navigation */
        .nav-3d-community {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 15px;
            background-color: rgba(0,0,0,0.7);
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            backdrop-filter: blur(5px);
        }
        
        .nav-3d-community-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: all 0.3s;
            font-size: 1.2rem;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .nav-3d-community-btn:hover {
            transform: translateY(-5px) scale(1.1);
            background-color: var(--secondary);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }
        
        /* Header (reused from homepage) */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 2rem;
            background-color: var(--dark);
            color: white;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 15px rgba(0,0,0,0.2);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .logo-icon {
            font-size: 1.8rem;
            color: var(--secondary);
        }
        
        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .logo-text span {
            color: var(--secondary);
        }
        
        /* Community-specific styles with animations */
        .community-hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 6rem 2rem 5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
            perspective: 1000px;
        }
        
        .community-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxkZWZzPjxwYXR0ZXJuIGlkPSJwYXR0ZXJuIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHBhdHRlcm5UcmFuc2Zvcm09InJvdGF0ZSg0NSkiPjxyZWN0IHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjA1KSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3QgZmlsbD0idXJsKCNwYXR0ZXJuKSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIvPjwvc3ZnPg==');
        }
        
        .community-hero-content {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            transform: translateZ(50px);
        }
        
        .community-hero h1 {
            font-size: 2.8rem;
            margin-bottom: 1.5rem;
            line-height: 1.2;
            font-weight: 700;
            animation: float 6s ease-in-out infinite;
        }
        
        .community-hero p {
            font-size: 1.2rem;
            margin-bottom: 2.5rem;
            opacity: 0.9;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            animation: float 6s ease-in-out infinite 0.5s;
        }
        
        .community-hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            animation: float 6s ease-in-out infinite 1s;
        }
        
        .btn {
            padding: 0.8rem 1.8rem;
            border-radius: 30px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            border: none;
        }
        
        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        .btn-outline {
            background-color: transparent;
            color: white;
            border: 2px solid white;
        }
        
        .btn-outline:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .community-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
            transform-style: preserve-3d;
        }
        
        .community-sidebar {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            height: fit-content;
            position: sticky;
            top: 20px;
            transform: translateZ(20px);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .community-sidebar:hover {
            transform: translateZ(30px) translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.12);
        }
        
        .community-main {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            transform-style: preserve-3d;
        }
        
        .community-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transform-style: preserve-3d;
            transform: translateZ(10px);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .community-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(74, 111, 165, 0.1) 0%, rgba(58, 90, 140, 0.05) 100%);
            z-index: -1;
        }
        
        .community-card:hover {
            transform: translateZ(30px) translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.12);
        }
        
        .community-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .community-card-title {
            font-size: 1.5rem;
            color: var(--dark);
            font-weight: 700;
            position: relative;
        }
        
        .community-card-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 50px;
            height: 3px;
            background-color: var(--secondary);
            border-radius: 3px;
        }
        
        .community-search {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .community-search input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.5rem;
            border-radius: 30px;
            border: 1px solid rgba(0,0,0,0.1);
            font-size: 0.95rem;
            transition: all 0.3s;
            background-color: var(--light);
        }
        
        .community-search input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
            background-color: white;
        }
        
        .community-search i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-lighter);
        }
        
        .community-group {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }
        
        .community-group:hover {
            transform: translateX(5px) translateZ(10px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            background-color: var(--light);
        }
        
        .community-group-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .community-group:hover .community-group-avatar {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .community-group-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .community-group-info h4 {
            font-size: 1rem;
            margin-bottom: 0.3rem;
            color: var(--dark);
        }
        
        .community-group-info p {
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        .community-group-members {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.8rem;
            color: var(--text-lighter);
            margin-top: 0.3rem;
        }
        
        .community-post {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            transform-style: preserve-3d;
        }
        
        .community-post:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .community-post-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .community-post-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transform: translateZ(10px);
        }
        
        .community-post-avatar:hover {
            transform: translateZ(20px) scale(1.1);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .community-post-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .community-post-user {
            flex-grow: 1;
        }
        
        .community-post-user h4 {
            font-size: 1.1rem;
            margin-bottom: 0.2rem;
            color: var(--dark);
        }
        
        .community-post-user p {
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        .community-post-options {
            position: relative;
        }
        
        .community-post-options-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--text-lighter);
            cursor: pointer;
            transition: all 0.3s;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .community-post-options-btn:hover {
            color: var(--primary);
            background-color: rgba(0,0,0,0.05);
        }
        
        .community-post-options-dropdown {
            position: absolute;
            right: 0;
            top: 100%;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            padding: 0.5rem 0;
            min-width: 180px;
            z-index: 10;
            display: none;
            transform: translateY(10px);
            opacity: 0;
            transition: all 0.3s;
            transform-style: preserve-3d;
            transform-origin: top right;
        }
        
        .community-post-options:hover .community-post-options-dropdown {
            display: block;
            transform: translateY(0);
            opacity: 1;
        }
        
        .community-post-options-dropdown a {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.7rem 1.2rem;
            color: var(--text);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .community-post-options-dropdown a:hover {
            background: var(--light);
            color: var(--primary);
            transform: translateX(5px);
        }
        
        .community-post-options-dropdown a i {
            width: 20px;
            text-align: center;
        }
        
        .community-post-content {
            margin-bottom: 1.5rem;
            line-height: 1.7;
            font-size: 1rem;
            color: var(--text);
            transform: translateZ(5px);
        }
        
        .community-post-image {
            width: 100%;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            max-height: 400px;
            object-fit: cover;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: translateZ(0);
        }
        
        .community-post-image:hover {
            transform: translateZ(20px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .community-post-actions {
            display: flex;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .community-post-action {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-light);
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 30px;
            background-color: transparent;
        }
        
        .community-post-action:hover {
            color: var(--primary);
            background-color: rgba(74, 111, 165, 0.1);
            transform: translateY(-2px);
        }
        
        .community-post-action.liked {
            color: var(--secondary);
            background-color: rgba(255, 107, 107, 0.1);
        }
        
        .community-post-comments {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(0,0,0,0.05);
        }
        
        .community-post-comment {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            transform-style: preserve-3d;
        }
        
        .community-post-comment:last-child {
            margin-bottom: 0;
        }
        
        .community-post-comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
            transition: all 0.3s;
            transform: translateZ(5px);
        }
        
        .community-post-comment-avatar:hover {
            transform: translateZ(15px) scale(1.1);
        }
        
        .community-post-comment-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .community-post-comment-content {
            background: var(--light);
            padding: 1rem;
            border-radius: 12px;
            flex-grow: 1;
            transition: all 0.3s;
            transform: translateZ(10px);
        }
        
        .community-post-comment:hover .community-post-comment-content {
            transform: translateZ(20px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .community-post-comment-user {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .community-post-comment-text {
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--text);
        }
        
        .community-post-comment-actions {
            display: flex;
            gap: 1rem;
            margin-top: 0.8rem;
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        .community-post-comment-action {
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .community-post-comment-action:hover {
            color: var(--primary);
        }
        
        .community-post-add-comment {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            transform-style: preserve-3d;
        }
        
        .community-post-add-comment input {
            flex-grow: 1;
            padding: 0.8rem 1.2rem;
            border-radius: 30px;
            border: 1px solid rgba(0,0,0,0.1);
            font-size: 0.95rem;
            transition: all 0.3s;
            background-color: var(--light);
            transform: translateZ(5px);
        }
        
        .community-post-add-comment input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
            background-color: white;
            transform: translateZ(10px);
        }
        
        .community-post-add-comment button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 0 1.8rem;
            cursor: pointer;
            transition: all 0.3s;
            transform: translateZ(5px);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }
        
        .community-post-add-comment button:hover {
            background: var(--primary-dark);
            transform: translateZ(10px) translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 111, 165, 0.3);
        }
        
        .community-create-post {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
            transform-style: preserve-3d;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .community-create-post:hover {
            transform: translateZ(20px) translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.12);
        }
        
        .community-create-post-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .community-create-post-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: all 0.3s;
            transform: translateZ(10px);
        }
        
        .community-create-post-avatar:hover {
            transform: translateZ(20px) scale(1.1);
        }
        
        .community-create-post-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .community-create-post-input {
            flex-grow: 1;
        }
        
        .community-create-post-input textarea {
            width: 100%;
            padding: 1.2rem;
            border-radius: 12px;
            border: 1px solid rgba(0,0,0,0.1);
            resize: none;
            min-height: 100px;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s;
            background-color: var(--light);
            transform: translateZ(5px);
        }
        
        .community-create-post-input textarea:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
            background-color: white;
            transform: translateZ(10px);
        }
        
        .community-create-post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
        }
        
        .community-create-post-options {
            display: flex;
            gap: 1rem;
        }
        
        .community-create-post-option {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transform: translateZ(5px);
        }
        
        .community-create-post-option:hover {
            color: var(--primary);
            background-color: rgba(0,0,0,0.05);
            transform: translateZ(10px) scale(1.1);
        }
        
        .community-create-post-submit {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 0.8rem 2rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: translateZ(5px);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .community-create-post-submit:hover {
            background: var(--primary-dark);
            transform: translateZ(10px) translateY(-3px);
            box-shadow: 0 8px 20px rgba(74, 111, 165, 0.4);
        }
        
        .community-create-post-submit:disabled {
            background-color: var(--text-lighter);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .community-events {
            margin-top: 2rem;
        }
        
        .community-events-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--dark);
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .community-events-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 30px;
            height: 2px;
            background-color: var(--secondary);
        }
        
        .community-event {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: all 0.3s;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }
        
        .community-event:hover {
            transform: translateX(5px) translateZ(10px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            background-color: var(--light);
        }
        
        .community-event-date {
            background: var(--light);
            border-radius: 8px;
            padding: 0.5rem;
            text-align: center;
            min-width: 50px;
            transition: all 0.3s;
        }
        
        .community-event:hover .community-event-date {
            background: var(--primary);
            color: white;
        }
        
        .community-event-date-day {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            transition: all 0.3s;
        }
        
        .community-event:hover .community-event-date-day {
            color: white;
        }
        
        .community-event-date-month {
            font-size: 0.8rem;
            color: var(--text-light);
            text-transform: uppercase;
            transition: all 0.3s;
        }
        
        .community-event:hover .community-event-date-month {
            color: rgba(255,255,255,0.8);
        }
        
        .community-event-info h4 {
            font-size: 0.95rem;
            margin-bottom: 0.3rem;
            color: var(--dark);
        }
        
        .community-event-info p {
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        .community-event-join {
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: var(--primary);
            cursor: pointer;
            display: inline-block;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .community-event-join:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }
        
        .community-event-join.joined {
            color: var(--success);
        }
        
        .community-view-all {
            display: block;
            text-align: center;
            margin-top: 1.5rem;
            color: var(--primary);
            font-size: 0.9rem;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            padding: 0.5rem;
            border-radius: 4px;
        }
        
        .community-view-all:hover {
            background-color: rgba(74, 111, 165, 0.1);
            text-decoration: underline;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            transform: translateZ(50px);
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px) translateZ(0);
            }
            to {
                opacity: 1;
                transform: translateY(0) translateZ(50px);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--dark);
            font-weight: 600;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            transition: all 0.3s;
        }
        
        .close-modal:hover {
            color: var(--secondary);
            transform: rotate(90deg);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem 1rem;
            border-radius: 8px;
            border: 1px solid rgba(0,0,0,0.1);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .modal-btn {
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }
        
        .modal-btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .modal-btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .modal-btn-secondary {
            background-color: var(--light);
            color: var(--text);
        }
        
        .modal-btn-secondary:hover {
            background-color: var(--light-dark);
        }
        
        /* 3D Floating Elements */
        .floating-element {
            position: absolute;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
            animation: float 8s ease-in-out infinite;
            z-index: -1;
        }
        
        /* Animations */
        @keyframes float {
            0% { transform: translateY(0) translateX(0) rotate(0deg); }
            50% { transform: translateY(-20px) translateX(10px) rotate(5deg); }
            100% { transform: translateY(0) translateX(0) rotate(0deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }
        
        .delay-1 { animation-delay: 0.2s; }
        .delay-2 { animation-delay: 0.4s; }
        .delay-3 { animation-delay: 0.6s; }
        .delay-4 { animation-delay: 0.8s; }
        
        /* Responsive styles */
        @media (max-width: 992px) {
            .community-container {
                grid-template-columns: 1fr;
            }
            
            .community-sidebar {
                position: static;
            }
            
            .community-hero h1 {
                font-size: 2.2rem;
            }
        }
        
        @media (max-width: 768px) {
            .community-hero {
                padding: 4rem 1rem 3rem;
            }
            
            .community-card, .community-create-post {
                padding: 1.5rem;
            }
            
            .community-post-actions {
                gap: 1rem;
            }
        }
        
        @media (max-width: 576px) {
            .community-hero h1 {
                font-size: 1.8rem;
            }
            
            .community-hero p {
                font-size: 1rem;
            }
            
            .community-post-action span {
                display: none;
            }
            
            .community-post-action {
                padding: 0.5rem;
            }
            
            .community-create-post-actions {
                flex-direction: column;
                gap: 1rem;
            }
            
            .community-create-post-options {
                justify-content: center;
            }
            
            .community-create-post-submit {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- 3D Background Container -->
    <div id="threejs-community-container"></div>
    
    <!-- 3D Navigation Controls -->
    <div class="nav-3d-community" id="nav3dCommunity">
        <div class="nav-3d-community-btn" id="home3dBtn"><i class="fas fa-home"></i></div>
        <div class="nav-3d-community-btn" id="groups3dBtn"><i class="fas fa-users"></i></div>
        <div class="nav-3d-community-btn" id="events3dBtn"><i class="fas fa-calendar-alt"></i></div>
        <div class="nav-3d-community-btn" id="chat3dBtn"><i class="fas fa-comments"></i></div>
        <div class="nav-3d-community-btn" id="toggle3dBtn"><i class="fas fa-cube"></i></div>
    </div>
    
    <!-- Floating 3D Elements -->
    <div class="floating-element" style="width: 100px; height: 100px; top: 10%; left: 5%; animation-delay: 0s;"></div>
    <div class="floating-element" style="width: 150px; height: 150px; top: 70%; left: 80%; animation-delay: 1s;"></div>
    <div class="floating-element" style="width: 80px; height: 80px; top: 40%; left: 90%; animation-delay: 2s;"></div>
    <div class="floating-element" style="width: 120px; height: 120px; top: 80%; left: 10%; animation-delay: 3s;"></div>
    
    <!-- Header -->
    <header>
        <div class="logo">
            <div class="logo-icon"><i class="fas fa-graduation-cap"></i></div>
            <div class="logo-text">Study<span>Hub</span></div>
        </div>
        
        <div class="user-controls">
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search...">
            </div>
            
            <!-- User profile dropdown would be here -->
        </div>
    </header>

    <!-- Community Hero Section -->
    <section class="community-hero fade-in">
        <div class="community-hero-content">
            <h1>Connect & Collaborate</h1>
            <p>Join thousands of students in our vibrant learning community. Share knowledge, ask questions, and grow together.</p>
            <div class="community-hero-buttons">
                <button class="btn btn-primary" id="createGroupBtn"><i class="fas fa-plus"></i> Create Study Group</button>
                <button class="btn btn-outline" id="findPeersBtn"><i class="fas fa-search"></i> Find Peers</button>
            </div>
        </div>
    </section>

    <!-- Main Community Content -->
    <div class="community-container">
        <!-- Sidebar -->
        <aside class="community-sidebar fade-in delay-1">
            <div class="community-search">
                <i class="fas fa-search"></i>
                <input type="text" id="groupSearch" placeholder="Search groups...">
            </div>
            
            <h3>Your Study Groups</h3>
            <div class="community-groups" id="studyGroupsList">
                <!-- Groups will be populated by JavaScript -->
            </div>
            
            <div class="community-events">
                <h3 class="community-events-title">Upcoming Events</h3>
                <div id="upcomingEventsList">
                    <!-- Events will be populated by JavaScript -->
                </div>
                <a href="#" class="community-view-all" id="viewAllEvents">View all events</a>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="community-main">
            <!-- Create Post Card -->
            <div class="community-create-post fade-in delay-2">
                <div class="community-create-post-header">
                    <div class="community-create-post-avatar">
                        <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&h=100&q=80" alt="User">
                    </div>
                    <div class="community-create-post-input">
                        <textarea id="newPostContent" placeholder="What's on your mind? Share a question, resource, or study tip..."></textarea>
                    </div>
                </div>
                <div class="community-create-post-actions">
                    <div class="community-create-post-options">
                        <button class="community-create-post-option" title="Add image" id="addImageBtn">
                            <i class="fas fa-image"></i>
                        </button>
                        <button class="community-create-post-option" title="Add document" id="addDocBtn">
                            <i class="fas fa-file-alt"></i>
                        </button>
                        <button class="community-create-post-option" title="Add poll" id="addPollBtn">
                            <i class="fas fa-poll"></i>
                        </button>
                    </div>
                    <button class="community-create-post-submit" id="submitPostBtn" disabled>Post</button>
                </div>
            </div>
            
            <!-- Community Posts -->
            <div class="community-card fade-in delay-3">
                <div class="community-card-header">
                    <h3 class="community-card-title">Recent Discussions</h3>
                    <div class="community-filter">
                        <select id="postFilter">
                            <option value="newest">Newest First</option>
                            <option value="popular">Most Popular</option>
                            <option value="questions">Questions Only</option>
                        </select>
                    </div>
                </div>
                
                <div id="postsContainer">
                    <!-- Posts will be populated by JavaScript -->
                </div>
            </div>
        </main>
    </div>

    <!-- Create Group Modal -->
    <div class="modal" id="createGroupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Study Group</h3>
                <button class="close-modal" id="closeGroupModal">&times;</button>
            </div>
            <form id="createGroupForm">
                <div class="form-group">
                    <label for="groupName">Group Name</label>
                    <input type="text" id="groupName" placeholder="e.g. Advanced Calculus Study Group" required>
                </div>
                <div class="form-group">
                    <label for="groupSubject">Subject</label>
                    <input type="text" id="groupSubject" placeholder="e.g. Mathematics" required>
                </div>
                <div class="form-group">
                    <label for="groupDescription">Description</label>
                    <textarea id="groupDescription" placeholder="Tell potential members about this group..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="groupPrivacy">Privacy Setting</label>
                    <select id="groupPrivacy" required>
                        <option value="public">Public (Anyone can join)</option>
                        <option value="private">Private (Requires approval)</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn modal-btn-secondary" id="cancelGroupBtn">Cancel</button>
                    <button type="submit" class="modal-btn modal-btn-primary">Create Group</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Event Modal -->
    <div class="modal" id="createEventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Event</h3>
                <button class="close-modal" id="closeEventModal">&times;</button>
            </div>
            <form id="createEventForm">
                <div class="form-group">
                    <label for="eventTitle">Event Title</label>
                    <input type="text" id="eventTitle" placeholder="e.g. Math Problem Solving Session" required>
                </div>
                <div class="form-group">
                    <label for="eventDate">Date</label>
                    <input type="date" id="eventDate" required>
                </div>
                <div class="form-group">
                    <label for="eventTime">Time</label>
                    <input type="time" id="eventTime" required>
                </div>
                <div class="form-group">
                    <label for="eventDuration">Duration (minutes)</label>
                    <input type="number" id="eventDuration" min="15" max="240" value="60" required>
                </div>
                <div class="form-group">
                    <label for="eventDescription">Description</label>
                    <textarea id="eventDescription" placeholder="Tell attendees what to expect..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="eventGroup">Associated Group (optional)</label>
                    <select id="eventGroup">
                        <option value="">None</option>
                        <option value="math">Math Study Group</option>
                        <option value="science">Science Club</option>
                        <option value="literature">Literature Circle</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn modal-btn-secondary" id="cancelEventBtn">Cancel</button>
                    <button type="submit" class="modal-btn modal-btn-primary">Create Event</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Three.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>

    <script>
        // Community Data Storage
        const communityData = {
            currentUser: {
                id: 1,
                name: "You",
                avatar: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&h=100&q=80"
            },
            groups: [
                {
                    id: 1,
                    name: "Math Study Group",
                    subject: "Algebra & Calculus",
                    members: 24,
                    avatar: "https://images.unsplash.com/photo-1434030216411-0b793f4b4173?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&h=100&q=80",
                    joined: true
                },
                {
                    id: 2,
                    name: "Science Club",
                    subject: "Physics & Chemistry",
                    members: 42,
                    avatar: "https://images.unsplash.com/photo-1532094349884-543bc11b234d?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&h=100&q=80",
                    joined: true
                },
                {
                    id: 3,
                    name: "Literature Circle",
                    subject: "Books & Writing",
                    members: 18,
                    avatar: "https://images.unsplash.com/photo-1503676260728-1c00da094a0b?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&h=100&q=80",
                    joined: true
                }
            ],
            events: [
                {
                    id: 1,
                    title: "Math Problem Solving",
                    date: "2023-06-15",
                    time: "16:00",
                    duration: 90,
                    group: "Math Study Group",
                    joined: false
                },
                {
                    id: 2,
                    title: "Science Fair Prep",
                    date: "2023-06-18",
                    time: "15:00",
                    duration: 120,
                    group: "Science Club",
                    joined: false
                },
                {
                    id: 3,
                    title: "Book Discussion",
                    date: "2023-06-22",
                    time: "18:00",
                    duration: 90,
                    group: "Literature Circle",
                    joined: false
                }
            ],
            posts: [
                {
                    id: 1,
                    userId: 2,
                    userName: "Alex Johnson",
                    userAvatar: "https://images.unsplash.com/photo-1570295999919-56ceb5ecca61?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&h=100&q=80",
                    group: "Math Study Group",
                    time: "2 hours ago",
                    content: "Can someone help me understand how to solve quadratic equations using the quadratic formula? I'm stuck on this problem:\n\n2x² - 4x - 6 = 0",
                    image: "https://images.unsplash.com/photo-1635070041078-e363dbe005cb?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&h=300&q=80",
                    likes: 8,
                    comments: [
                        {
                            id: 1,
                            userId: 4,
                            userName: "Maria Garcia",
                            userAvatar: "https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&h=100&q=80",
                            content: "First, identify a, b, and c in your equation. Here a=2, b=-4, c=-6. Then plug them into the formula: x = [-b ± √(b²-4ac)] / 2a",
                            time: "1 hour ago",
                            likes: 3
                        }
                    ],
                    liked: false
                },
                {
                    id: 2,
                    userId: 5,
                    userName: "Sam Wilson",
                    userAvatar: "https://images.unsplash.com/photo-1544725176-7c40e5a71c5e?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&h=100&q=80",
                    group: "Science Club",
                    time: "5 hours ago",
                    content: "Just found this amazing resource for understanding chemical bonding! It has interactive simulations that really help visualize the concepts.\n\nhttps://example.com/chem-bonding",
                    likes: 15,
                    comments: [],
                    liked: true
                },
                {
                    id: 3,
                    userId: 6,
                    userName: "Taylor Smith",
                    userAvatar: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&h=100&q=80",
                    group: "Literature Circle",
                    time: "1 day ago",
                    content: "Our next book for discussion will be \"To Kill a Mockingbird\" by Harper Lee. The meeting will be on June 22nd at 6 PM. Please read chapters 1-5 before the meeting!",
                    image: "https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&h=300&q=80",
                    likes: 12,
                    comments: [
                        {
                            id: 2,
                            userId: 7,
                            userName: "Jamie Lee",
                            userAvatar: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&h=100&q=80",
                            content: "Excited for this! I've read it before but looking forward to discussing it with everyone.",
                            time: "20 hours ago",
                            likes: 2
                        },
                        {
                            id: 3,
                            userId: 8,
                            userName: "Chris Taylor",
                            userAvatar: "https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&h=100&q=80",
                            content: "Does anyone have suggestions for where to get a copy? Our local library has a waiting list.",
                            time: "18 hours ago",
                            likes: 1
                        }
                    ],
                    liked: false
                }
            ]
        };

        // DOM Elements
        const elements = {
            studyGroupsList: document.getElementById('studyGroupsList'),
            upcomingEventsList: document.getElementById('upcomingEventsList'),
            postsContainer: document.getElementById('postsContainer'),
            newPostContent: document.getElementById('newPostContent'),
            submitPostBtn: document.getElementById('submitPostBtn'),
            postFilter: document.getElementById('postFilter'),
            groupSearch: document.getElementById('groupSearch'),
            createGroupBtn: document.getElementById('createGroupBtn'),
            createGroupModal: document.getElementById('createGroupModal'),
            closeGroupModal: document.getElementById('closeGroupModal'),
            cancelGroupBtn: document.getElementById('cancelGroupBtn'),
            createGroupForm: document.getElementById('createGroupForm'),
            viewAllEvents: document.getElementById('viewAllEvents'),
            createEventModal: document.getElementById('createEventModal'),
            closeEventModal: document.getElementById('closeEventModal'),
            cancelEventBtn: document.getElementById('cancelEventBtn'),
            createEventForm: document.getElementById('createEventForm'),
            addImageBtn: document.getElementById('addImageBtn'),
            addDocBtn: document.getElementById('addDocBtn'),
            addPollBtn: document.getElementById('addPollBtn'),
            findPeersBtn: document.getElementById('findPeersBtn')
        };

        // Initialize the page
        function initCommunityPage() {
            renderStudyGroups();
            renderUpcomingEvents();
            renderPosts();
            setupEventListeners();
        }

        // Render study groups in sidebar
        function renderStudyGroups() {
            elements.studyGroupsList.innerHTML = '';
            
            communityData.groups.forEach(group => {
                const groupElement = document.createElement('div');
                groupElement.className = 'community-group';
                groupElement.innerHTML = `
                    <div class="community-group-avatar">
                        <img src="${group.avatar}" alt="${group.name}">
                    </div>
                    <div class="community-group-info">
                        <h4>${group.name}</h4>
                        <p>${group.subject}</p>
                        <div class="community-group-members">
                            <i class="fas fa-users"></i> ${group.members} members
                        </div>
                    </div>
                `;
                elements.studyGroupsList.appendChild(groupElement);
            });
            
            // Add "View all groups" link
            const viewAllLink = document.createElement('a');
            viewAllLink.href = '#';
            viewAllLink.className = 'community-view-all';
            viewAllLink.textContent = 'View all groups';
            elements.studyGroupsList.appendChild(viewAllLink);
        }

        // Render upcoming events in sidebar
        function renderUpcomingEvents() {
            elements.upcomingEventsList.innerHTML = '';
            
            communityData.events.forEach(event => {
                const eventDate = new Date(event.date);
                const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                const day = eventDate.getDate();
                const month = monthNames[eventDate.getMonth()];
                
                const eventElement = document.createElement('div');
                eventElement.className = 'community-event';
                eventElement.innerHTML = `
                    <div class="community-event-date">
                        <div class="community-event-date-day">${day}</div>
                        <div class="community-event-date-month">${month}</div>
                    </div>
                    <div class="community-event-info">
                        <h4>${event.title}</h4>
                        <p>${event.time} - ${calculateEndTime(event.time, event.duration)}</p>
                        <span class="community-event-join ${event.joined ? 'joined' : ''}">
                            ${event.joined ? 'Joined ✓' : 'Join Event'}
                        </span>
                    </div>
                `;
                elements.upcomingEventsList.appendChild(eventElement);
                
                // Add event listener for join button
                const joinBtn = eventElement.querySelector('.community-event-join');
                joinBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    event.joined = !event.joined;
                    this.classList.toggle('joined');
                    this.textContent = event.joined ? 'Joined ✓' : 'Join Event';
                    
                    // Animation
                    gsap.to(this, {
                        scale: 1.2,
                        duration: 0.2,
                        yoyo: true,
                        ease: "power1.out"
                    });
                });
            });
        }

        // Helper function to calculate end time
        function calculateEndTime(startTime, duration) {
            const [hours, minutes] = startTime.split(':').map(Number);
            const totalMinutes = hours * 60 + minutes + duration;
            const endHours = Math.floor(totalMinutes / 60) % 24;
            const endMinutes = totalMinutes % 60;
            return `${endHours.toString().padStart(2, '0')}:${endMinutes.toString().padStart(2, '0')}`;
        }

        // Render posts in main content
        function renderPosts(filter = 'newest') {
            elements.postsContainer.innerHTML = '';
            
            // Sort posts based on filter
            let sortedPosts = [...communityData.posts];
            
            if (filter === 'newest') {
                // Already in order (newest first) in our data
            } else if (filter === 'popular') {
                sortedPosts.sort((a, b) => b.likes - a.likes);
            } else if (filter === 'questions') {
                sortedPosts = sortedPosts.filter(post => post.content.includes('?'));
            }
            
            sortedPosts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'community-post';
                postElement.innerHTML = `
                    <div class="community-post-header">
                        <div class="community-post-avatar">
                            <img src="${post.userAvatar}" alt="${post.userName}">
                        </div>
                        <div class="community-post-user">
                            <h4>${post.userName}</h4>
                            <p>Posted in ${post.group} · ${post.time}</p>
                        </div>
                        <div class="community-post-options">
                            <button class="community-post-options-btn">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                            <div class="community-post-options-dropdown">
                                <a href="#"><i class="fas fa-bookmark"></i> Save post</a>
                                <a href="#"><i class="fas fa-flag"></i> Report</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="community-post-content">
                        ${formatPostContent(post.content)}
                    </div>
                    
                    ${post.image ? `<img src="${post.image}" alt="Post image" class="community-post-image">` : ''}
                    
                    <div class="community-post-actions">
                        <div class="community-post-action ${post.liked ? 'liked' : ''}">
                            <i class="${post.liked ? 'fas' : 'far'} fa-thumbs-up"></i>
                            <span>${post.liked ? 'Liked' : 'Like'}</span>
                            <span class="like-count">${post.likes}</span>
                        </div>
                        <div class="community-post-action">
                            <i class="far fa-comment"></i>
                            <span>Comment</span>
                        </div>
                        <div class="community-post-action">
                            <i class="fas fa-share"></i>
                            <span>Share</span>
                        </div>
                    </div>
                    
                    <div class="community-post-comments">
                        ${post.comments.map(comment => `
                            <div class="community-post-comment">
                                <div class="community-post-comment-avatar">
                                    <img src="${comment.userAvatar}" alt="${comment.userName}">
                                </div>
                                <div class="community-post-comment-content">
                                    <div class="community-post-comment-user">${comment.userName}</div>
                                    <div class="community-post-comment-text">${comment.content}</div>
                                    <div class="community-post-comment-actions">
                                        <span class="community-post-comment-action ${comment.likes > 0 ? 'liked' : ''}">
                                            Like
                                        </span>
                                        <span class="community-post-comment-action">Reply</span>
                                        <span>${comment.time}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        
                        <div class="community-post-add-comment">
                            <input type="text" placeholder="Write a comment..." class="comment-input">
                            <button class="comment-submit"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                `;
                elements.postsContainer.appendChild(postElement);
                
                // Add event listeners for this post
                setupPostEventListeners(postElement, post);
            });
        }

        // Format post content with paragraphs and links
        function formatPostContent(content) {
            // Split by new lines and wrap in paragraphs
            const paragraphs = content.split('\n').filter(p => p.trim() !== '');
            
            // Detect URLs and convert to links
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            
            return paragraphs.map(p => {
                // Replace URLs with links
                let formatted = p.replace(urlRegex, url => {
                    return `<a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>`;
                });
                return `<p>${formatted}</p>`;
            }).join('');
        }

        // Set up event listeners for a post
        function setupPostEventListeners(postElement, postData) {
            // Like button
            const likeBtn = postElement.querySelector('.community-post-action:first-child');
            likeBtn.addEventListener('click', function() {
                postData.liked = !postData.liked;
                if (postData.liked) {
                    postData.likes++;
                    this.classList.add('liked');
                    this.querySelector('i').className = 'fas fa-thumbs-up';
                    this.querySelector('span').textContent = 'Liked';
                } else {
                    postData.likes--;
                    this.classList.remove('liked');
                    this.querySelector('i').className = 'far fa-thumbs-up';
                    this.querySelector('span').textContent = 'Like';
                }
                this.querySelector('.like-count').textContent = postData.likes;
                
                // Animation
                gsap.to(this, {
                    scale: 1.2,
                    duration: 0.2,
                    yoyo: true,
                    repeat: 1,
                    ease: "power1.out"
                });
            });
            
            // Comment like buttons
            postElement.querySelectorAll('.community-post-comment-action').forEach(action => {
                if (action.textContent === 'Like') {
                    action.addEventListener('click', function() {
                        this.classList.toggle('liked');
                    });
                }
            });
            
            // Comment submission
            const commentInput = postElement.querySelector('.comment-input');
            const commentSubmit = postElement.querySelector('.comment-submit');
            
            commentSubmit.addEventListener('click', function() {
                addComment(commentInput, postData);
            });
            
            commentInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addComment(commentInput, postData);
                }
            });
            
            // Post image hover effect
            const postImage = postElement.querySelector('.community-post-image');
            if (postImage) {
                postImage.addEventListener('mouseenter', function() {
                    gsap.to(this, {
                        scale: 1.02,
                        boxShadow: '0 10px 30px rgba(0,0,0,0.2)',
                        duration: 0.3,
                        ease: "power1.out"
                    });
                });
                
                postImage.addEventListener('mouseleave', function() {
                    gsap.to(this, {
                        scale: 1,
                        boxShadow: '0 5px 20px rgba(0,0,0,0.1)',
                        duration: 0.3,
                        ease: "power1.out"
                    });
                });
            }
        }

        // Add a comment to a post
        function addComment(commentInput, postData) {
            const commentText = commentInput.value.trim();
            
            if (commentText) {
                const newComment = {
                    id: Date.now(), // Simple unique ID
                    userId: communityData.currentUser.id,
                    userName: communityData.currentUser.name,
                    userAvatar: communityData.currentUser.avatar,
                    content: commentText,
                    time: 'Just now',
                    likes: 0
                };
                
                postData.comments.push(newComment);
                renderPosts(elements.postFilter.value);
                
                // Scroll to the new comment
                setTimeout(() => {
                    const comments = document.querySelectorAll('.community-post-comment');
                    if (comments.length > 0) {
                        comments[comments.length - 1].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                }, 100);
            }
        }

        // Set up all event listeners
        function setupEventListeners() {
            // Post submission
            elements.newPostContent.addEventListener('input', function() {
                elements.submitPostBtn.disabled = this.value.trim() === '';
            });
            
            elements.submitPostBtn.addEventListener('click', createNewPost);
            
            // Post filtering
            elements.postFilter.addEventListener('change', function() {
                renderPosts(this.value);
            });
            
            // Group search
            elements.groupSearch.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const groups = document.querySelectorAll('.community-group');
                
                groups.forEach(group => {
                    const groupName = group.querySelector('h4').textContent.toLowerCase();
                    if (groupName.includes(searchTerm)) {
                        group.style.display = 'flex';
                    } else {
                        group.style.display = 'none';
                    }
                });
            });
            
            // Create group modal
            elements.createGroupBtn.addEventListener('click', function() {
                elements.createGroupModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            });
            
            elements.closeGroupModal.addEventListener('click', closeGroupModal);
            elements.cancelGroupBtn.addEventListener('click', closeGroupModal);
            
            elements.createGroupForm.addEventListener('submit', function(e) {
                e.preventDefault();
                createNewGroup();
            });
            
            // View all events
            elements.viewAllEvents.addEventListener('click', function(e) {
                e.preventDefault();
                // In a real app, this would navigate to an events page
                alert('View all events functionality would show a full events calendar here.');
            });
            
            // Create event modal (triggered from somewhere)
            // For demo purposes, we'll trigger it from the "Find Peers" button
            elements.findPeersBtn.addEventListener('click', function(e) {
                e.preventDefault();
                elements.createEventModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                
                // Set default date to tomorrow
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                document.getElementById('eventDate').valueAsDate = tomorrow;
            });
            
            elements.closeEventModal.addEventListener('click', closeEventModal);
            elements.cancelEventBtn.addEventListener('click', closeEventModal);
            
            elements.createEventForm.addEventListener('submit', function(e) {
                e.preventDefault();
                createNewEvent();
            });
            
            // Post attachment buttons
            elements.addImageBtn.addEventListener('click', function(e) {
                e.preventDefault();
                alert('In a full implementation, this would open a file picker to select an image.');
            });
            
            elements.addDocBtn.addEventListener('click', function(e) {
                e.preventDefault();
                alert('In a full implementation, this would open a file picker to select a document.');
            });
            
            elements.addPollBtn.addEventListener('click', function(e) {
                e.preventDefault();
                alert('In a full implementation, this would open a poll creation form.');
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === elements.createGroupModal) {
                    closeGroupModal();
                }
                if (e.target === elements.createEventModal) {
                    closeEventModal();
                }
            });
        }

        // Create a new post
        function createNewPost() {
            const content = elements.newPostContent.value.trim();
            
            if (content) {
                const newPost = {
                    id: Date.now(), // Simple unique ID
                    userId: communityData.currentUser.id,
                    userName: communityData.currentUser.name,
                    userAvatar: communityData.currentUser.avatar,
                    group: "General Discussion",
                    time: "Just now",
                    content: content,
                    likes: 0,
                    comments: [],
                    liked: false
                };
                
                communityData.posts.unshift(newPost); // Add to beginning of array
                renderPosts(elements.postFilter.value);
                elements.newPostContent.value = '';
                elements.submitPostBtn.disabled = true;
                
                // Scroll to the new post
                setTimeout(() => {
                    const posts = document.querySelectorAll('.community-post');
                    if (posts.length > 0) {
                        posts[0].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                }, 100);
            }
        }

        // Create a new group
        function createNewGroup() {
            const name = document.getElementById('groupName').value.trim();
            const subject = document.getElementById('groupSubject').value.trim();
            const description = document.getElementById('groupDescription').value.trim();
            const privacy = document.getElementById('groupPrivacy').value;
            
            const newGroup = {
                id: Date.now(), // Simple unique ID
                name: name,
                subject: subject,
                description: description,
                privacy: privacy,
                members: 1,
                avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=${privacy === 'public' ? '4a6fa5' : 'ff6b6b'}&color=fff&size=100`,
                joined: true
            };
            
            communityData.groups.unshift(newGroup); // Add to beginning of array
            renderStudyGroups();
            closeGroupModal();
            
            // Show success message
            alert(`"${name}" group created successfully!`);
        }

        // Create a new event
        function createNewEvent() {
            const title = document.getElementById('eventTitle').value.trim();
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const duration = parseInt(document.getElementById('eventDuration').value);
            const description = document.getElementById('eventDescription').value.trim();
            const group = document.getElementById('eventGroup').value;
            
            const eventDate = new Date(date);
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            const month = monthNames[eventDate.getMonth()];
            const day = eventDate.getDate();
            
            const newEvent = {
                id: Date.now(), // Simple unique ID
                title: title,
                date: date,
                time: time,
                duration: duration,
                description: description,
                group: group || "General Event",
                joined: false
            };
            
            communityData.events.unshift(newEvent); // Add to beginning of array
            renderUpcomingEvents();
            closeEventModal();
            
            // Show success message
            alert(`"${title}" event created successfully!`);
        }

        // Close group modal
        function closeGroupModal() {
            elements.createGroupModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            elements.createGroupForm.reset();
        }

        // Close event modal
        function closeEventModal() {
            elements.createEventModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            elements.createEventForm.reset();
        }

        // 3D Scene Variables
        let communityScene, communityCamera, communityRenderer, communityControls;
        let isCommunity3DModeActive = false;
        
        // Initialize 3D Scene for Community
        function initCommunity3DScene() {
            // Create scene
            communityScene = new THREE.Scene();
            communityScene.background = new THREE.Color(0xf0f4f8);
            
            // Create camera
            communityCamera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            communityCamera.position.z = 5;
            
            // Create renderer
            communityRenderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            communityRenderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('threejs-community-container').appendChild(communityRenderer.domElement);
            
            // Add controls
            communityControls = new THREE.OrbitControls(communityCamera, communityRenderer.domElement);
            communityControls.enableDamping = true;
            communityControls.dampingFactor = 0.05;
            communityControls.enableZoom = false;
            communityControls.enablePan = false;
            
            // Add ambient light
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            communityScene.add(ambientLight);
            
            // Add directional light
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            communityScene.add(directionalLight);
            
            // Create floating knowledge particles
            createFloatingParticles();
            
            // Create floating community elements
            createCommunityElements();
            
            // Handle window resize
            window.addEventListener('resize', onCommunityWindowResize);
        }
        
        // Create floating particles
        function createFloatingParticles() {
            const particlesGeometry = new THREE.BufferGeometry();
            const particleCount = 500;
            
            const posArray = new Float32Array(particleCount * 3);
            for(let i = 0; i < particleCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 20;
            }
            
            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            
            const particlesMaterial = new THREE.PointsMaterial({
                size: 0.1,
                color: 0x4a6fa5,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });
            
            const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
            communityScene.add(particlesMesh);
        }
        
        // Create floating community elements
        function createCommunityElements() {
            // Create floating books
            const bookGeometry = new THREE.BoxGeometry(0.5, 0.7, 0.1);
            const bookMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x4a6fa5,
                metalness: 0.2,
                roughness: 0.7
            });
            
            for(let i = 0; i < 10; i++) {
                const book = new THREE.Mesh(bookGeometry, bookMaterial);
                book.position.set(
                    (Math.random() - 0.5) * 15,
                    (Math.random() - 0.5) * 10,
                    (Math.random() - 0.5) * 10
                );
                book.rotation.set(
                    Math.random() * Math.PI,
                    Math.random() * Math.PI,
                    Math.random() * Math.PI
                );
                communityScene.add(book);
                
                // Animation
                gsap.to(book.rotation, {
                    y: Math.PI * 2,
                    duration: 30 + Math.random() * 30,
                    repeat: -1,
                    ease: "none"
                });
                
                gsap.to(book.position, {
                    y: book.position.y + 0.5,
                    duration: 3 + Math.random() * 3,
                    yoyo: true,
                    repeat: -1,
                    ease: "sine.inOut"
                });
            }
            
            // Create floating speech bubbles
            const bubbleGeometry = new THREE.SphereGeometry(0.3, 16, 16);
            const bubbleMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xffffff,
                metalness: 0.1,
                roughness: 0.5,
                transparent: true,
                opacity: 0.8
            });
            
            for(let i = 0; i < 8; i++) {
                const bubble = new THREE.Mesh(bubbleGeometry, bubbleMaterial);
                bubble.position.set(
                    (Math.random() - 0.5) * 15,
                    (Math.random() - 0.5) * 10,
                    (Math.random() - 0.5) * 10
                );
                communityScene.add(bubble);
                
                // Animation
                gsap.to(bubble.position, {
                    x: bubble.position.x + (Math.random() - 0.5) * 2,
                    z: bubble.position.z + (Math.random() - 0.5) * 2,
                    duration: 5 + Math.random() * 10,
                    yoyo: true,
                    repeat: -1,
                    ease: "sine.inOut"
                });
                
                gsap.to(bubble.scale, {
                    x: 1.2,
                    y: 1.2,
                    z: 1.2,
                    duration: 3 + Math.random() * 4,
                    yoyo: true,
                    repeat: -1,
                    ease: "sine.inOut"
                });
            }
        }
        
        // Handle window resize
        function onCommunityWindowResize() {
            communityCamera.aspect = window.innerWidth / window.innerHeight;
            communityCamera.updateProjectionMatrix();
            communityRenderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Animation loop
        function animateCommunityScene() {
            requestAnimationFrame(animateCommunityScene);
            
            if (isCommunity3DModeActive) {
                communityControls.update();
                communityRenderer.render(communityScene, communityCamera);
            }
        }

        // Initialize the page when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initCommunityPage();
            
            // Initialize 3D scene
            initCommunity3DScene();
            animateCommunityScene();
            
            // 3D Toggle Button
            document.getElementById('toggle3dBtn').addEventListener('click', function() {
                isCommunity3DModeActive = !isCommunity3DModeActive;
                const container = document.getElementById('threejs-community-container');
                
                if (isCommunity3DModeActive) {
                    container.classList.add('active');
                    this.innerHTML = '<i class="fas fa-times"></i>';
                    communityCamera.position.set(0, 3, 5);
                    communityControls.target.set(0, 0, 0);
                    
                    // Animate camera for a more engaging entrance
                    gsap.from(communityCamera.position, {
                        z: 15,
                        duration: 1.5,
                        ease: "back.out(1.7)"
                    });
                } else {
                    container.classList.remove('active');
                    this.innerHTML = '<i class="fas fa-cube"></i>';
                }
            });
            
            // Animate elements on scroll
            const animateOnScroll = function() {
                const elements = document.querySelectorAll('.fade-in');
                elements.forEach(element => {
                    const elementPosition = element.getBoundingClientRect().top;
                    const windowHeight = window.innerHeight;
                    
                    if (elementPosition < windowHeight - 100) {
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0)';
                    }
                });
            };
            
            // Initialize animations
            window.addEventListener('load', function() {
                document.querySelectorAll('.fade-in').forEach(el => {
                    el.style.opacity = '0';
                    el.style.transform = 'translateY(20px)';
                    el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                });
                
                animateOnScroll();
            });
            
            window.addEventListener('scroll', animateOnScroll);
        });
    </script>
</body>
</html>